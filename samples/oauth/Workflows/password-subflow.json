{
  "key": "password-subflow",
  "flow": "sys-flows",
  "domain": "core",
  "version": "1.0.0",
  "tags": [
    "oauth2",
    "password",
    "subflow",
    "authentication",
    "user-credentials"
  ],
  "attributes": {
    "type": "S",
    "timeout": null,
    "labels": [
      {
        "language": "en-US",
        "label": "Password Grant Subflow"
      },
      {
        "language": "tr-TR",
        "label": "Password Grant Alt Akışı"
      }
    ],
    "functions": [],
    "features": [],
    "extensions": [],
    "sharedTransitions": [],
    "startTransition": {
      "key": "start-password-flow",
      "target": "validate-user-credentials",
      "triggerType": 0,
      "versionStrategy": "Minor",
      "labels": [
        {
          "language": "en-US",
          "label": "Start Password Flow"
        },
        {
          "language": "tr-TR",
          "label": "Password Akışını Başlat"
        }
      ],
      "schema": null,
      "rule": null,
      "timer": null,
      "view": null,
      "onExecutionTasks": []
    },
    "states": [
      {
        "key": "validate-user-credentials",
        "stateType": 1,
        "versionStrategy": "Minor",
        "labels": [
          {
            "language": "en-US",
            "label": "Validate User Credentials"
          },
          {
            "language": "tr-TR",
            "label": "Kullanıcı Kimlik Bilgilerini Doğrula"
          }
        ],
        "view": null,
        "subFlow": null,
        "onEntries": [
          {
            "order": 1,
            "task": {
              "key": "validate-user-credentials",
              "domain": "core",
              "version": "1.0.0",
              "flow": "sys-tasks"
            },
            "mapping": {
              "location": "./src/ValidateUserCredentialsMapping.csx",
              "code": "dXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrczsKdXNpbmcgQkJULldvcmtmbG93LlNjcmlwdGluZzsKdXNpbmcgQkJULldvcmtmbG93LkRlZmluaXRpb25zOwoKLy8vIDxzdW1tYXJ5PgovLy8gT0F1dGgyIFVzZXIgQ3JlZGVudGlhbHMgVmFsaWRhdGlvbiBNYXBwaW5nIC0gVXNlciBjcmVkZW50aWFsIHZhbGlkYXRpb24gbWFwcGluZwovLyBUaGlzIG1hcHBpbmcgaXMgdXNlZCB0byB2YWxpZGF0ZSB1c2VyIGNyZWRlbnRpYWxzIGluIHRoZSBPQXV0aDIgcGFzc3dvcmQgZ3JhbnQgZmxvdy4KLy8vIDwvc3VtbWFyeT4KcHVibGljIGNsYXNzIFZhbGlkYXRlVXNlckNyZWRlbnRpYWxzTWFwcGluZyA6IElNYXBwaW5nCnsKICAgIC8vLyA8c3VtbWFyeT4KICAgIC8vLyBQcmVwYXJlIGlucHV0IGZvciB1c2VyIGNyZWRlbnRpYWwgdmFsaWRhdGlvbiByZXF1ZXN0CiAgICAvLy8gPC9zdW1tYXJ5PgogICAgcHVibGljIFRhc2s8U2NyaXB0UmVzcG9uc2U+IElucHV0SGFuZGxlcihXb3JrZmxvd1Rhc2sgdGFzaywgU2NyaXB0Q29udGV4dCBjb250ZXh0KQogICAgewogICAgICAgIHRyeQogICAgICAgIHsKICAgICAgICAgICAgdmFyIGh0dHBUYXNrID0gdGFzayBhcyBIdHRwVGFzazsKICAgICAgICAgICAgaWYgKGh0dHBUYXNrID09IG51bGwpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkT3BlcmF0aW9uRXhjZXB0aW9uKCJUYXNrIG11c3QgYmUgYW4gSHR0cFRhc2sgZm9yIHVzZXIgY3JlZGVudGlhbHMgdmFsaWRhdGlvbiIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgcmVxdWVzdEJvZHkgPSBuZXcKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdXNlcm5hbWUgPSBjb250ZXh0LkJvZHk/LnVzZXJuYW1lID8/IGNvbnRleHQuQm9keT8uZW1haWwsCiAgICAgICAgICAgICAgICBwYXNzd29yZCA9IGNvbnRleHQuQm9keT8ucGFzc3dvcmQKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGh0dHBUYXNrLlNldEJvZHkocmVxdWVzdEJvZHkpOwoKICAgICAgICAgICAgLy8gU2V0IHRoZSBoZWFkZXJzCiAgICAgICAgICAgIHZhciBoZWFkZXJzID0gbmV3IERpY3Rpb25hcnk8c3RyaW5nLCBzdHJpbmc/PgogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBbIlgtUmVxdWVzdC1JZCJdID0gY29udGV4dC5JbnN0YW5jZT8uRGF0YT8ucmVxdWVzdElkLAogICAgICAgICAgICAgICAgWyJDb250ZW50LVR5cGUiXSA9ICJhcHBsaWNhdGlvbi9qc29uIgogICAgICAgICAgICB9OwoKICAgICAgICAgICAgaHR0cFRhc2suU2V0SGVhZGVycyhoZWFkZXJzKTsKCiAgICAgICAgICAgIHJldHVybiBUYXNrLkZyb21SZXN1bHQobmV3IFNjcmlwdFJlc3BvbnNlKCkpOwogICAgICAgIH0KICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGV4KQogICAgICAgIHsKICAgICAgICAgICAgcmV0dXJuIFRhc2suRnJvbVJlc3VsdChuZXcgU2NyaXB0UmVzcG9uc2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyA8c3VtbWFyeT4KICAgIC8vLyBQcm9jZXNzIHVzZXIgYXV0aGVudGljYXRpb24gcmVzdWx0IGFuZCBtZXJnZSBpdCBpbnRvIHRoZSB3b3JrZmxvdyBpbnN0YW5jZQogICAgLy8vIDwvc3VtbWFyeT4KICAgIHB1YmxpYyBhc3luYyBUYXNrPFNjcmlwdFJlc3BvbnNlPiBPdXRwdXRIYW5kbGVyKFNjcmlwdENvbnRleHQgY29udGV4dCkKICAgIHsKICAgICAgICAgdmFyIHJlc3BvbnNlID0gbmV3IFNjcmlwdFJlc3BvbnNlKCk7CiAgICAgICAgdHJ5CiAgICAgICAgewogICAgICAgICAgICB2YXIgc3RhdHVzQ29kZSA9IEdldFN0YXR1c0NvZGVGcm9tUmVzcG9uc2UoY29udGV4dCk7CiAgICAgICAgICAgIHZhciByZXNwb25zZURhdGEgPSBHZXRSZXNwb25zZURhdGFGcm9tQ29udGV4dChjb250ZXh0KTsKCiAgICAgICAgICAgIC8vIFN1Y2Nlc3NmdWwgdmFsaWRhdGlvbgogICAgICAgICAgICBpZiAoc3RhdHVzQ29kZSA+PSAyMDAgJiYgc3RhdHVzQ29kZSA8IDMwMCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgcmVzcG9uc2UuRGF0YSA9IG5ldwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGF1dGhlbnRpY2F0aW9uID0gbmV3IAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzcyA9IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJJZCA9IHJlc3BvbnNlRGF0YT8udXNlcklkLAogICAgICAgICAgICAgICAgICAgICAgICB1c2VybmFtZSA9IHJlc3BvbnNlRGF0YT8udXNlcm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgIGVtYWlsID0gcmVzcG9uc2VEYXRhPy5lbWFpbCwKICAgICAgICAgICAgICAgICAgICAgICAgcm9sZXMgPSByZXNwb25zZURhdGE/LnJvbGVzLAogICAgICAgICAgICAgICAgICAgICAgICAvLyBNRkEgY29udGV4dAogICAgICAgICAgICAgICAgICAgICAgICBtZmFSZXF1aXJlZCA9IHJlc3BvbnNlRGF0YT8ubWZhUmVxdWlyZWQgPz8gdHJ1ZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICByZXNwb25zZS5EYXRhID0gbmV3CiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgYXV0aGVudGljYXRpb24gPSBuZXcKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3MgPSBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSAiSW52YWxpZCB1c2VybmFtZSBvciBwYXNzd29yZCIsCiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yQ29kZSA9ICJpbnZhbGlkX2NyZWRlbnRpYWxzIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY2F0Y2ggKEV4Y2VwdGlvbiBleCkKICAgICAgICB7CiAgICAgICAgICAgIHJlc3BvbnNlLkRhdGEgPSBuZXcKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgYXV0aGVudGljYXRpb24gPSBuZXcKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBzdWNjZXNzID0gZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSAiSW50ZXJuYWwgcHJvY2Vzc2luZyBlcnJvciIsCiAgICAgICAgICAgICAgICAgICAgZXJyb3JDb2RlID0gInByb2Nlc3NpbmdfZXJyb3IiLAogICAgICAgICAgICAgICAgICAgIGVycm9yRGVzY3JpcHRpb24gPSBleC5NZXNzYWdlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXNwb25zZTsKICAgIH0KCiAgICAjcmVnaW9uIEhlbHBlciBNZXRob2RzCgogICAgcHJpdmF0ZSBzdGF0aWMgaW50IEdldFN0YXR1c0NvZGVGcm9tUmVzcG9uc2UoU2NyaXB0Q29udGV4dCBjb250ZXh0KQogICAgewogICAgICAgIGlmIChjb250ZXh0LkJvZHk/LnN0YXR1c0NvZGUgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIChpbnQpY29udGV4dC5Cb2R5LnN0YXR1c0NvZGU7CgogICAgICAgIHJldHVybiAyMDA7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgZHluYW1pYz8gR2V0UmVzcG9uc2VEYXRhRnJvbUNvbnRleHQoU2NyaXB0Q29udGV4dCBjb250ZXh0KQogICAgewogICAgICAgIGlmIChjb250ZXh0LkJvZHk/LmRhdGEgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGNvbnRleHQuQm9keS5kYXRhOwoKICAgICAgICBpZiAoY29udGV4dC5Cb2R5ICE9IG51bGwgJiYgY29udGV4dC5Cb2R5LnN0YXR1c0NvZGUgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGNvbnRleHQuQm9keTsKCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgI2VuZHJlZ2lvbgp9Cg=="
            }
          }
        ],
        "onExits": [],
        "transitions": [
          {
            "key": "credentials-valid",
            "target": "password-success",
            "triggerType": 1,
            "versionStrategy": "Minor",
            "labels": [
              {
                "language": "en-US",
                "label": "User Credentials Valid"
              },
              {
                "language": "tr-TR",
                "label": "Kullanıcı Kimlik Bilgileri Geçerli"
              }
            ],
            "schema": null,
            "rule": {
              "location": "./src/AuthorizationSuccessRule.csx",
              "code": "dXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrczsKdXNpbmcgQkJULldvcmtmbG93LlNjcmlwdGluZzsKCnB1YmxpYyBjbGFzcyBBdXRob3JpemF0aW9uU3VjY2Vzc1J1bGUgOiBJQ29uZGl0aW9uTWFwcGluZwp7CiAgICBwdWJsaWMgYXN5bmMgVGFzazxib29sPiBIYW5kbGVyKFNjcmlwdENvbnRleHQgY29udGV4dCkKICAgIHsKICAgICAgICByZXR1cm4gY29udGV4dC5JbnN0YW5jZS5EYXRhLmF1dGhlbnRpY2F0aW9uLnN1Y2Nlc3MgPT0gdHJ1ZTsKICAgIH0KfQo="
            },
            "timer": null,
            "view": null,
            "onExecutionTasks": []
          },
          {
            "key": "credentials-invalid",
            "target": "password-failed",
            "triggerType": 1,
            "versionStrategy": "Minor",
            "labels": [
              {
                "language": "en-US",
                "label": "User Credentials Invalid"
              },
              {
                "language": "tr-TR",
                "label": "Kullanıcı Kimlik Bilgileri Geçersiz"
              }
            ],
            "schema": null,
            "rule": {
              "location": "./src/AuthorizationFailedRule.csx",
              "code": "dXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrczsKdXNpbmcgQkJULldvcmtmbG93LlNjcmlwdGluZzsKCnB1YmxpYyBjbGFzcyBBdXRob3JpemF0aW9uRmFpbGVkUnVsZSA6IElDb25kaXRpb25NYXBwaW5nCnsKICAgIHB1YmxpYyBhc3luYyBUYXNrPGJvb2w+IEhhbmRsZXIoU2NyaXB0Q29udGV4dCBjb250ZXh0KQogICAgewogICAgICAgIHJldHVybiBjb250ZXh0Lkluc3RhbmNlLkRhdGEuYXV0aGVudGljYXRpb24uc3VjY2VzcyA9PSBmYWxzZTsKICAgIH0KfQo="
            },
            "timer": null,
            "view": null,
            "onExecutionTasks": []
          }
        ]
      },
      {
        "key": "password-success",
        "stateType": 3,
        "versionStrategy": "Minor",
        "labels": [
          {
            "language": "en-US",
            "label": "Password Authentication Success"
          },
          {
            "language": "tr-TR",
            "label": "Password Kimlik Doğrulama Başarılı"
          }
        ],
        "view": null,
        "subFlow": null,
        "onEntries": [],
        "onExits": [],
        "transitions": []
      },
      {
        "key": "password-failed",
        "stateType": 3,
        "versionStrategy": "Minor",
        "labels": [
          {
            "language": "en-US",
            "label": "Password Authentication Failed"
          },
          {
            "language": "tr-TR",
            "label": "Password Kimlik Doğrulama Başarısız"
          }
        ],
        "view": null,
        "subFlow": null,
        "onEntries": [],
        "onExits": [],
        "transitions": []
      }
    ]
  }
}